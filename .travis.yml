jobs:
  include:
  - language: node.js
    nodejs:
    - "10.11"
    stage: test
    before_install:
    - npm install -g swagger-cli
    before_script:
    - cd api/
    script:
    - swagger-cli validate api.yaml

  - stage: deploy
    language: bash
    services:
    - docker
    install:
    - docker build -t swagger-ui-geo-rest -f Dockerfile.swagger-ui .
    deploy:
    - provider: script
      script: >
        echo "$DOCKERHUB_PASSWORD" | docker login -u "$DOCKERHUB_NAME" --password-stdin &&
        docker tag swagger-ui-geo-rest $DOCKERHUB_NAME/swagger-ui-geo-rest &&
        docker push $DOCKERHUB_NAME/swagger-ui-geo-rest
      on:
        branch: master
    - provider: script
      script: >
        echo "$DOCKERHUB_PASSWORD" | docker login -u "$DOCKERHUB_NAME" --password-stdin &&
        docker tag swagger-ui-geo-rest $DOCKERHUB_NAME/swagger-ui-geo-rest &&
        docker push $DOCKERHUB_NAME/swagger-ui-geo-rest
      on:
        branch: develop


